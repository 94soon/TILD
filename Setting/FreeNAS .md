#FreeNAS



![](https://michaelgroff.info/wp-content/uploads/FreeNAS-Logo.png)



> 본 문서는 FreeNAS 11 버전을 기준으로 작성되었습니다. 
>
> 작성 시점과 실제 설치 시점에는 기능업데이트 및 변동 사항이 있을 수 있기 때문에 참고사항으로만 사용바랍니다. 



### FreeNAS 소개 

* FreeNAS는  FreeBSD 기반의 내장형 오픈 소스 NAS (network-attached storage) 운영 체제이며 BSD 라이센스 하에 배포되는 파일 저장 및 공유에 최적화된 운영체제 입니다. 
* FreeNAS 는 브라우저 기반 그래픽 구성 인터페이스를 제공합니다. 내장 네트워킹 프로토콜은 여러 운영 체제에 대한 스토리지 액세스를 제공합니다. 추가 소프트웨어를 설치하여 내장 기능을 확장 할 수있는 플러그인 시스템이 제공됩니다. 



### 하드웨어 권장 사항 

* FreeNAS 는 64 비트 프로세서에서만 사용할 수 있습니다. 이 아키텍처는 AMD의 *amd64* 및 *Intel의 Intel 64* 라고 합니다. 
* 최소 8GB RAM이 필요합니다. 
  * 추가기능을 사용하기 위해서는 많은 메모리가 필요하며, 대용량 스토리지 캐시에는 더 많은 메모리가 필요합니다. 
  * 한편 FreeNAS를 설치하는 경우 헤드리스 시스템에서 BIOS에서 비디오 카드의 공유 메모리 설정을 해제합니다.
  * 하드웨어가 지원하는 경우 ECC RAM을 설치하십시오. 더 비싸지 만 ECC RAM은 ZFS의 오류 수정 속성이 작동하기 전에 데이터의 기내 손상을 방지하므로 ZFS에서 수행하는 체크섬 및 패리티 계산에 일관성을 제공합니다.
  * 8GB 보다 적은 RAM을 사용하는 경우 정상적인 동작이 어려울 수 있습니다. 
* FreeNAS 운영 체제는 스토리지 디스크와 별도로 하나 이상의 장치에 설치됩니다. 
* 이 장치는 SSD, USB 메모리 스틱 또는 DOM (Disk on Module) 일 수 있습니다. 하드 드라이브에 설치하는 것은 데이터 저장을 위해 해당 드라이브를 사용할 수 없기 때문에 권장하지 않습니다.
* OS설치를 위한 최소 공간은 8GB, 권장 16GB 입니다. 
* USB에 OS를 설치하는 경우 ZFS는 저렴한 USB에 오류를 파악하여 정상적인 동작이 어려울 수 있기 때문에 품질이 좋고 유명한 USB을 사용할 것을 권장합니다. 
* SSD 는 빠르고 안정적이며 매우 좋은 FreeNAS 운영 체제 장치입니다. SSD를 사용하는 것을 매우 권장합니다. 
* NIC는 인텔, Chelsio 인터페이스에서 최상의 성능을 보았으므로 새 NIC를 구입할 때이 브랜드를 고려해야 합니다. 
  * Realtek 카드는 종종 이러한 칩셋과의 인터페이스가 자체 프로세서를 제공하지 않으므로 CPU 부하가 크게 나타날 수 있습니다. 
  * 네트워크 성능이 필요하고 사용할 비용이 있으면 10 GigE 인터페이스와 관리되는 스위치를 사용하십시오. 
  * LACP 및 점보 프레임을 지원하는 관리 형 스위치를 사용하면 네트워크 처리량을 향상시킬 수 있으므로이 스위치를 사용하는 것이 좋습니다.



### 설치 및 업그레이드 

* FreeNAS 운영 체제는 스토리지 데이터를 저장하는 드라이브와는 별도의 장치에 설치해야합니다. 즉, 하나의 디스크 드라이브 만 있으면 FreeNAS 그래픽 인터페이스를 사용할 수 있지만 데이터를 저장할 공간이 없습니다. 결국 데이터 저장은 결국 NAS 시스템의 핵심입니다.

#### 미디어 준비 

* FreeNAS는 USB 혹은 CD를 통해 부팅할 수 있습니다.
  * USB보다는 CD로 ISO 파일을 부팅 디스크로 설치하는 것이 오류 발생확률이 더 적습니다. 
* OS 다운로드를 위한 주소는 다음과 같습니다. 
  * http://www.freenas.org/



#### 설치

![](http://doc.freenas.org/11/_images/grubmenu.png)

* 위와 같이 설치 미디어를 부팅디스크로 부팅하면 다음과 같은 GRUB 메뉴가 표시됩니다. 

![](http://doc.freenas.org/11/_images/install2c.png)

* 1번의 Install/Upgrade 항목을 선택하고 OK 항목을 선택합니다. 
  * RAM이 8GB 미만이면 경고메시지가 표시됩니다. 

![](http://doc.freenas.org/11/_images/install3a.png)

* 운영체제를 설치할 디스크를 선택합니다. 
* 운영체제를 설치하게 되면, 그 디스크는 데이터를 저장할 수 없습니다. 
* 부팅장치를 미러링 하려면 2개의 부팅 디스크를 선택합니다. 

![](http://doc.freenas.org/11/_images/cdrom3a.png)

![](http://doc.freenas.org/11/_images/upgrade1a.png)

* 기존 버전이 설치되어 있으면 위와 같은 메시지가 표시됩니다. 새로 설치하는 경우 이 경고 메시지가 나타나지 않습니다. 

![](http://doc.freenas.org/11/_images/install4a.png)

* Root 사용자의 Password를 설정합니다. 

![](http://doc.freenas.org/11/_images/install5.png)

* UEFI 혹은 표준 BIOS  부팅 구성을 선택합니다. 최신 버전의 메인보드를 사용하는 경우 UEFI 바이오스를 선택하고 그렇지 않은 경우 반드시 표준 BIOS 설치를 진행해야 합니다. 

![](http://doc.freenas.org/11/_images/cdrom4a.png)

* 잠시기다리면 모든 설치가 완료 됩니다. 설치 미디어를 제거하고 정상적으로 부팅이 되는지 확인합니다. 



#### 설치 중 문제 

```
run_interrupt_driven_hooks: still waiting after 60 seconds for xpt_config
```

* 위와 같은 메시지가 표시되면서 설치가 정상적으로 진행되지 않는다면 BIOS 항목에서 IEEE1394 컨트롤러 항목을 중지해야 합니다. 



### Booting 

* 부팅하는 동안 FreeNAS는 DHCP를 통해 자동으로 IP 주소를 할당합니다. 

* IP 주소가 정상적으로 할당받으면 콘솔에 할당받은 IP 주소가 보여지며, 주소를 통해 GUI 화면으로 접속할 수 있습니다. 

  ![](http://doc.freenas.org/11/_images/quick-login.png)

* 위와 같은 화면에 설치시 설정했던 비밀번호를 입력하고 접속을 시도합니다. 

  * 11버전에서는 Beta UI를 지원합니다. 

* 로그인이 성공하면 아래와 같은 화면을 볼 수 있습니다.

  ![](http://doc.freenas.org/11/_images/initial1c.png)

  

* 본 웹 인터페이스는 IE9에서 오류가 있습니다. Firefox를 사용할 것을 권장합니다. 



### 계정 

* 본 절에서는 그룹을 만들고 계정을 만드는 방법에 대해서 알아봅니다. 

* Groups ‣ View Groups에 들어가면 다음과 같은 그림을 볼 수 있습니다.

  ![](http://doc.freenas.org/11/_images/group1.png)

#### 그룹 관리 

* 운영 체제와 함께 제공된 모든 그룹이 나열됩니다. 각 그룹에는 그룹 ID, 그룹 이름, FreeNAS®를 사용하여 설치된 기본 제공 그룹인지 여부, 그룹 구성원이 Sudo를 사용할 수 있는지 여부를 나타내는 항목이 있습니다. 그룹 항목을 클릭하면 구성원 단추가 나타납니다. 그룹 구성원 자격을 보고수정하려면 버튼을 클릭합니다.

* Add Group  버튼을 누르면 다음과 같은 그림을 볼 수 있습니다. 

  ![](http://doc.freenas.org/11/_images/group2.png)



#### 그룹 생성하기 

|       Setting       |  Value   |                         Description                          |
| :-----------------: | :------: | :----------------------------------------------------------: |
|      Group ID       |  string  | 다음 사용 가능한 그룹 ID가 제안됩니다. 일반적으로 사용자 계정을 포함하는 UNIX그룹의 ID가 1000보다 크고 서비스에 필요한 그룹의 ID는 서비스에서 사용하는 기본 포트 번호(예:sshID)와 동일합니다. |
|     Group Name      |  string  |                   반드시 작성해야 합니다.                    |
|        sudo         | checkbox |            옵션 선택시 sudo 권한을 가지게 됩니다.            |
| Allow repeated GIDs | checkbox |      여러 그룹이 동일한 그룹ID(GID) 공유할 수 있습니다.      |





![](http://doc.freenas.org/11/_images/group3.png)



* 그룹과 사용자를 만든 후에는 사용자를 그룹의 구성원으로 만들 수 있습니다. 



#### 사용자 

* reeNAS는 사용자, 그룹 및 권한을 지원하므로 FreeNAS®에 저장된 데이터에 액세스 할 수 있는 사용자를 구성할 수 있는 유연성이 큽니다. 

* 공유에 사용 권한을 할당하려면 다음 중 하나를 수행해야 합니다.  

  * 모든 사용자가 사용할 게스트 계정을 생성하거나 각 계정의 이름이 컴퓨터에 사용된 로그온 이름과 같은 네트워크의 모든 사용자에 대해 사용자 계정을 생성합니다. 
  * 예를 들어 Windows시스템에 bobsmith라는 로그인 이름이 있는 경우 FreeNAS에 bobsmith라는 이름의 사용자 계정을 만듭니다. 
  * 일반적인 전략은 공유에 대해 서로 다른 권한 집합을 가진 그룹을 만든 다음 해당 그룹에 사용자를 할당하는 것입니다. 
  * 네트워크에서 디렉터리 서비스를 사용하는 경우 디렉터리 서비스의 지침에 따라 기존 계정 정보를 가져오십시오. 

  * Account -> User -> View Users는 그림과 같이 FreeNAS운영 체제와 함께 설치된 모든 시스템 계정 목록을 제공합니다.

    

    ![](http://doc.freenas.org/11/_images/account-users.png)



### 볼륨 

* 볼륨관리자를 통해서 볼륨을 생성하고 삭제할 수 있습니다. 

* 디스크 보기를 통해서 현재 설치된 디스크 볼륨을 확인할 수 있습니다. 

  ![](http://doc.freenas.org/11/_images/view.png)

* ZFS 파일시스템을 사용하는 경우 FreeNAS는 아래와 같은 소프트웨어 레이드를 지원합니다. 

  * 스트라이프 : 적어도 하나의 디스크가 필요합니다. 
  * 미러 : 최소 2개의 디스크가 필요합니다. 데이터는 모든 디스크에 똑같이 저장됩니다. 
  * RAIDZ1 : 최소 3개의 디스크가 필요합니다. 
  * RAIDZ2 : 최소 4개의 디스크가 필요합니다. 
    * 연구실 NAS가 이 방식을 사용하고 있습니다. 
    * 최대 2개의 하드디스크가 고장나도, 분산된 패리티 정보를 통해 손실된 데이터를 자동으로 복구할 수 있습니다. 
  * RAIDZ3 : 최소 5개의 디스크가 필요합니다. 
  * 로그장치 : 적어도 하나의 전용장치가 필요하며 대기시간이 짧고 전원이 보호되는 SSD를 권장합니다. 
  * 캐시장치 : 반드시 SSD를 사용합니다.  

#### 암호화 

* 암호화를 사용하는 경우 반드시 다음 유의사항을 숙지해야 합니다. 
  * 성능은 암호화 디스크의 수에 따라 다릅니다. 
  * 암호화 볼륨의 드라이브가 많은 수록 암호 해독을 위해 오버해드가 증가하고 성능에 미치는 영향이 커지게 됩니다. 
  * 8개 이상의 드라이브로 구성된 암호화 볼륨은 심각한 성능 저하를 일으킬 수 있습니다. 
    * AES-NI 명령어를 지원하는 프로세스를 사용할 것을 강력히 권장합니다. 
    * 본 명령어는 시스템의 부하를 줄이고 효과적으로 소수의 디스크 또는 다수의 디스크의 암호화를 처리할 수 있다는 장점이 있습니다.  



#### ZFS 볼륨 확장 

* 디스크를 추가로 장착하는 경우 볼륨을 확장할 수 있으며 있으나 제한적으로 사용할 것을 권장합니다. 
* 볼륨을 확장하는 경우 데이터 손실을 야기할 수 있으며,  확장은 볼륨 생성에 비해 제약적인 기능을 제공합니다. 



#### 고장난 드라이브 교체 

* 어떤 형태의 RAID 방식을 사용하고 있던간에 디스크의 문제가 발생하면 가능한 빨리 디스크 교체를 진행해야 합니다. 
* AHCI를 지원하는 경우 재부팅 과정 없이 바로 교체할 수 있습니다. 
* 고장난 장치를 물리적으로 제거하기 전에 Storage -> Volumes 항목으로 이동하여 볼륨의 이름을 선택합니다. 
* 디스크 항목을 클릭하여 오프라인 상태로 변경해야 합니다. 이 단계에는 ZFS 풀에서 장치를 올바르게 제거하고 스왑 문제를 방지하기 위해 반드시 시행할 것을 권장합니다. 
* 대부분의 시스템은 AHCI를 지원하며, 핫스왑을 지원하기 때문에 전원을 중지하지 않고 디스크를 교체해도 상관없지만 안전성을 좀더 고려해야 한다면 전원을 끄고 문제가 발생한 디스크를 교체할 것을 권장합니다. 
* 새로운 디스크로 교체한 다음 항목에서 오프라인으로 표시된 디스크를 찾아 선택하고 교체 버튼을 클릭합니다. 
* 즉시 ZFS 풀이 시작되며, 복구 프로세스가 시작됩니다. 시간은 디스크 용량에 따라 다소 시간이 걸릴 수 있습니다. 
* 드라이브 교체가 완료되면 SMART Tests를 다시 추가 해야 합니다. 
  - SMART는 디스크의 상태를 확인하기 위해서 필요한 작업이긴 하지만 너무 자주 스케줄을 실행하는 경우 디스크의 I/O 성능을 심각하게 저하시키는 요인이 됩니다. 





### 공유 

* 공유는 네트워크의 다른 컴퓨터에서 볼륨의 일부 또는 전체를 접근할 수 있도록 만들어집니다. 

* 생성할 공유 유형은 네트워크 PC에서 사용하는 OS, 보안 요구 사항, 네트워크 속도에 따라서 실 성능은 달라질 수 있습니다. 

* FreeNAS는 다음 유형의 공유 및 서비스를 사용할 수 있습니다. 

  * AFP :  Apple File Protocol 공유는 클라이언트 컴퓨터가 모두 Mac OS X을 실행할 때 자주 사용됩니다. Apple은Time Machine에도 AFP가 필요하지만 현대 네트워크에서는 SMB를 선호합니다. 
  * NFS : 네트워크 파일 시스템 공유는 Mac OS X, Linux, BSD 및 Windows의 전문 및 엔터프라이즈 버전 (홈 에디션 제외)에서 액세스 할 수 있습니다. 클라이언트 컴퓨터가 모두 동일한 운영 체제를 실행하지는 않지만 NFS 클라이언트 소프트웨어를 모두 사용할 수있는 경우이 옵션을 사용하는 것이 좋습니다.
  * WebDAV :  WebDAV 공유는 인증 된 웹 브라우저 (읽기 전용) 또는 모든 운영 체제에서 실행되는 WebDAV 클라이언트를 사용하여 액세스 할 수 있습니다.
  * SMB : CIFS (Common Internet File System) 공유라고도하는 서버 메시지 블록 공유는 Windows, Mac OS X, Linux 및 BSD 컴퓨터에서 액세스 할 수 있습니다. Samba의 단일 스레드 설계로 인해 액세스가 NFS 공유보다 느립니다. SMB는 NFS보다 많은 구성 옵션을 제공하며 Windows 시스템 용 네트워크에서 좋은 선택입니다.

  * iSCSI : VMware와 같은 가상화 솔루션을 실행하는 클라이언트에 블록 또는 iSCSI 공유가 포맷되지 않은 디스크로 나타납니다. 이들은 일반적으로 가상 드라이브로 사용됩니다.

#### Windos SMB 공유 

* FreeNAS는 Samba 를 사용하여 Microsoft의 SMB 프로토콜을 사용하여 볼륨을 공유합니다. SMB는 Windows 및 Mac OS X 운영 체제에 내장되어 있으며 대부분의 Linux 및 BSD 시스템은 SMB에 대한 지원을 제공하기 위해 Samba 클라이언트를 사전 설치합니다. 배포판이 아니라면 배포판의 소프트웨어 저장소를 사용하여 Samba 클라이언트를 설치하십시오.

* SMB 프로토콜은 매우 단순한 구성에서부터 매우 복잡한 구성 시나리오에 이르기까지 다양한 유형의 구성 시나리오를 지원합니다. 시나리오의 복잡성은 공유에 연결할 클라이언트 운영 체제의 유형과 버전, 네트워크에 Windows 서버가 있는지 여부 및 Active Directory의 사용 여부에 따라 다릅니다. 인증 요구 사항에 따라 사용자 및 그룹을 만들거나 가져와야 할 수 있습니다.

* 공유 -> Windows (SMB 공유) -> Windows (SMB) 공유 추가를 클릭하면 다음과 같은 그림이 표시됩니다. 

  ![](http://doc.freenas.org/11/_images/cifs2a.png)

  





  