# 이동통신 프로토콜 
## 무선센서 네트워크 

* 원거리와 고속의 무선기술이 있으며 간단하게 근거리와 저속 어플리케이션에 적용될 수 있는 네트워크도 존재한다. 
* 무선센서 네트워크는 데이터 전송속도와 통신거리를 어느정도 희생하더라도 저전력, 저비용 확보 
	* WPAN(Wireless Personal Area Network) 개인의 행동범위 (수십미터)를 커버하는 네트워크 

	
### IEEE 802.15.4 -> Low Rate WPAN (ZIGBEE) 
* 무선센서 네트워크에 적용하는 저속 통신속도의 무선PAN 제안 

* IEEE 802.15.4 규격 범위는 PHY와 MAC이 존재하고 상위 프로토콜은 Zigbee 연합에서 관리 
   2.4GHz 주파수를 사용하며, 낮은 통신속도, 낮은 전력소비, 저비용이 특징임	

   ![](http://magazine.hellot.net/editor/CrossEditorV3.0.0.27/binary/images/000574/20151229103136990_QXD7MRWN.jpg)

### WSN (Wireless Sensor Netrworks) : Wireless Sensor & Actuator Networks 
* 무선센서 내트워크의 적용대상에는 계측용 센서뿐만 아니라 제어용 actuator(실제동작)도 포함 
* 제여계측 분야에서 종래의 유선방식에서 다루기 어려운 어플리케이션과 같은 새로운 통신 인프라를 제고할 수 있을 것으로 기대함
* 통상적으로 게이트웨이를 경유하여 이더넷 백본, 직렬통신, 필드 버스 등의 유선 네트워크와 접속, 계측제어 데이터 엑세스 단말 기능 담당
* 빌딩 오토메이션, 홈 오토메이션, 공장 오토메이션 등에 활용됨

#### 무선센서 네트워크를 계측설계에 적용함으로써 기대되는 장점들 
* 비용절감 - 제어계측 기기의 배선 비용이 기기 본체보다 비쌈
* 생산 프로세스 변경의 유연성 - 새로운 요구에 신속하고 용이하게 대응 
* 센싱 범위의 확대 - 수백 개 계측점의 대량 센서 배치 가능 


### 종래의 무선센서 네트워크의 단점 
* 표준화된 프로토콜의 결여 - 각 제조사별 독자규격 사용 
* 부품의 안정적인 공급 - 비표준화된 제품은 특정 제조사로부터 조달이 가능함으로 안정적 공급이 보장되지 않음 
* 상호 접속성 - 각각의 장비들은 같은 제조사에서만 사용가능, 상호 접속성이 거의 불가능 
* _표준화된 무선센서 네트워크가 출현_

- 무선센서 네트워크는 소비전력(전지수명), 가격, 보안에 대한 우선순위가 높다. 
	- 낮은 소비전력 
		- 센서와 actuator 등의 부품으로 전지 교환 없이 수년간 연속작동 가능함이 요구 
		- 전력을 줄이기 위해 저소비전력, 고집적도 RF 칩 구현, 낮은 동작주기(통신하지 않으면 sleep)
		- 전지수명은 데이터의 송신주기, 통신의 방향성, 데이터 프레임의 길이, 데이터전송의 지연시간에 좌우 
	- 저비용 
		- 고도집적화 IC 부품의 채용
		- 최소 크기 메모리를 가지는 마이크로프로세서 사용 ( 가능한 간단한 통신 프로토콜 사용 ) 
	
	- 보안 
		- 표준화된 무선센서 네트워크가 확삼됨에 따라 보안의 요구도 상승 
	- 전파법 규제 
		- 무선센서 네트워크에 채용되는 통신규격은 규제에 허가되는 범위에서 동작해야함 
		- ISM Band : 면허 없이 이용 가능한 주파수 대역 

		



## ZIGBEE 
![](https://www.kocoafab.cc/data/141118022241.png)

* 센서 및 제어계측 무선 네트워크를 위한 국제적인 업계의 표준화 기술 
	* 저소비전력 
	* 저비용 
	* 수백 이상의 네트워크의 용량 
	* 상호 접속성 

### ZIGBEE 1.0의 특징 
|특징|설명|
|---|---|
|물리층, MAC층 | IEEE 802.15.4 |
|저소비전력| 전지수명 수 개월 ~ 수년 |
|데이터 전송속도 | 250kbps (보다 낮음)|
|수신 범위| 실내 30m, 실외 10m (매우 좋은환경)|
|토폴로지|star, mesh, cluster tree|
|애드 훅|자기조직이 가능함|
|네트워크 용량| 최대 65,636 (이론상)|
|주파수 대역| ISM band 2.4GHz|
|접근제어|CSMA/CA|
|Full handshake| 전송 신뢰성 보증|
|기타|보증 타임슬롯, 암호화, 인증|

### Zigbee 아키텍쳐 
![](https://c1.staticflickr.com/1/220/444808527_00fbb287b5_z.jpg?zz=1)    

|명칭|약칭|주요기능|
|---|---|---|
|어플리케이션층| APL | 사용자 통신 어플리케이션 |
|어플리케이션 지원 부층 | APS | 어플리케이션간 논리적 통신경로 확립, 데이터 교환, 메시지 착신 및 재전송 요구 |
|네트워크층|NWK|네트워크 관리, 라우팅, 메시지 전송|
|미디어 액세스층| MAC | 1홉 내에서 메시지 전송 및 착신확인 및 재전송 요구|
|물리층|PHY|통신에 사용되는 주파수, 채널, 변조방식, 프레임 구조|

### 논리 디바이스 타입 
|IEEE 802.15.4 명칭|PAN 코디네이터|코디네이터|네트워크 디바이스|
|---|---|---|---|
|Zigbee 명칭| Zigbee 코디네이터| Zigbee 라우터 | Zigbee 엔드 디바이스|
|네트워크 기동 기능| 유 | 무 | 무 |
|라우터 기능| 유 | 유 |무 |
|비콘 발행|가능|가능|불가|
|관리범위|전체 노드| 자기의 자식노드| 자신|
|가능 노드 수|1 노드| 복수 노드 가능| 자신|
|전력소비|대|대|소|
|요구되는 마이크로 프로세스 지원|대|중|소|
* Coordinator : PAN을 전체적으로 관리하는 노드 
* Router : 전송 착신지 수소에 따라 적절한 통신 경로를 선택하는 기능을 가지는 노드 
* End device : router 혹은 coordinator와만 통신할 수 있는 제한된 기능을 가진 노드 

### 물리 디바이스 타입 
* FPP (Full function device) : 라우터 기능을 포함한 전체 기능을 가지는 디바이스 
* RFD (Reduce function device) : 엔드 디바이스로 제한  

### 프리미티브 
* 네트워크 각 층에서 제공되눈 서비스의 인터페이스 
* 모든 서비스는 클라이언트에 해당하는 서비스 요구측, 서버에 해당하는 제공측 사이에 프리미티브로 정보 전달 
* 4 종류의 프리미티브 
	* 요구 
	* 통지 
	* 응답 
	* 확인 
* 모든 서비스에 4종의 프리미티브가 갖추어질 필요는 없다  

## 물리층
* 2.4GHz 대역의 IEE 802.15.4 채널로 각 채널당 5MHz, 16개의 채널로 구성되어 있음 
	* 대역이 좁다는 것은 한꺼번에 통신할 수 있는 양이 적다는 것
* 무선통신 거리는 사용환경에 크게 좌우된다. 
* 물리층 데이터 서비스 -> 프리미티브(PG-DATA) 
	* 요구, 확인 통지(상대방 장치에 데이터 왔어요)
	* 맥 계층에게 데이터를 보낼 수 있는 서비스를 함
* PG-DATA indication은 프레임 데이터를 수신측 MAC에 전송함과 동시에 수신한 프레임의 링크 품질 지수를 통지한다. 
	* LGI : 링크 품질 지수, RSSI(세기)라고 표현한다. 얼마나 깨끗하게 잘 들어왔는지...
* 클리어 채널 판정 PLME-CCA 
	* 다른 노드의 메시지와 충돌을 회피하기 위해 데이터를 전송하기 전에 채널이 일정시간 이상 계속해서 비어 있는 상태를 확인 

* 물리층 전송에 필요한 최대 시간(최대 250kbps일때) = ((5 + 1 + 127) x 8) / 250,000 = 4.265 msec 
	* 네트워크에 자주 이용되고 있는 데이터 프레임은 길이가 대개 30바이트 전후로 필요한 송신시간은 약 1밀리초 
	* 빠른 속도는 아니다. 하지만 PAN네트워크에서는 사용할만 함. 
* 물리층 프레임 구조에서 동기헤더는 Preamble과 SFD(Start of Frame Delimiter)로 구성 
	* SFD : 동기신호의 종료와 실제 송신 데이터의 개시를 수신측에 통지 즉 수신측에 통지하면 SFD, 수신측이 SFD를 수신하면 그 다음부터 데이터 수신 
	 * 즉 Preamble이 들어오기 시작하면 그때부터 데이터가 들어오는구나 하고 생각

## MAC 
* CSMA/CD 
	* CSMA -> Carrier Sensing하여 전송로가 비어있으면 전송을 시작 
	* CD방식은 유선, CA는 무선방식 
	* 네트워크의 통신대역 자원을 최대한으로 이용할 수 있지만, 통신지연시간을 제어하기 어렵다. 
* 신뢰성 있는 데이터 통신 링크 
* 네트워크의 접속과 절단 
* 슈퍼프레임의 동기신호인 비콘의 발신(AP가 지속적으로 보낸는 신호, FDD만 옵션) 
	* IEEE 802.15.4 네트워크의 노드들끼리 상호 협조하여 동작가능한 구조 -> 슈퍼프레임과 비콘기술 사용
	* 슈퍼프레임은 시간의 흐름을 나눠서 써보자는 개념 
	* 비콘이 시작되면 CAP (경쟁 접근 구간), CFS (비경쟁 구간) -> [ GTS (보장 구간) ] 이후 비콘이 수신되면 끝 
	* 비콘이 방생하는 시간은 정확하고 변하지 않음, 장치간 시간동기화가 필수, 이후 0번 슬롯에는 신호를 보내지 않고 이후 CSMA/CA로 동작 
	* 즉 슈퍼 프레임을 이용하기 위해서 각 노드는 동기화 되어야 하고 이를 위해 비콘을 사용한다. 
	* GTS가 보장되는 경우 CSMA/CA를 거치지 않는다. 
* 비콘 수신에 의한 부모노드와의 동기(옵션) 
* 신간 보증 슬롯의 관리 (옵션) -> GTS(Guaranteed Time Slot), 그 시간에는 나만 통신할 수 있도록 함
* 암호화 보안기능(옵션) 


### 데이터 전송 모델 
#### 비콘 네트워크의 데이터 전송모델 
* 스타 토폴리지에서만 가능 
* 부모노드는 복수의 자식노드와 데이터 교환이 가능하지만, 자식노드끼리의 직접통신(peer to peer)은 하지 못함 
* 비콘 네트워크의 CSMA/CA 방식의 송신개시 시간은 임의의 시간이 아닌 슬롯의 시간에 맞추어야 함

_코디네이터는 각 디바이스보다 전력소모가 높다. 디바이스는 저전력을 요구해야 하기 때문에 대부분 자고 있다._ 
#### push형 데이터 전송 - 디바이스가 코디네이터에게 전송 
* 비콘 수신 (디바이스 입장)
* 데이터 전송 
* 확인응답(옵션) 

#### pull형 데이터 전송 - 코디네이터가 디바이스에게 전송 
* 비콘 수신 (디바이스 입장)
* 디바이스가 데이터가 있으면 달라고 코디네이터에게 요청 
* 코디네이터는 디바이스에게 ACK를 응답함 
* 데이터가 있으므로 데이터를 전송
* 디바이스가 데이터를 받았다는 ACK를 전송 

#### 비 비콘 네트워크의 데이터 전송모델 
* 슬롯의 개념이 사라진다. (슈퍼프레임 사용x) - 실제 Zigbee는 슈퍼프레임구조를 사용하지 않음 
* 디바이스는 보내고 싶을때, 비콘없이 CSMA/CA로 전송한다. 

#### push형 데이터 전송 - 디바이스가 코디네이터에게 전송 
* 데이터 전송 
* 확인응답(옵션) 

#### pull형 데이터 전송 - 코디네이터가 디바이스에게 전송 
* 디바이스가 데이터가 있으면 달라고 코디네이터에게 요청 (디바이스가 언제 깨어나는지에 따라 주기가 달라짐)
* 코디네이터는 디바이스에게 ACK를 응답함 
* 데이터가 있으므로 데이터를 전송
* 디바이스가 데이터를 받았다는 ACK를 전송 


* MCPS-PURGE 
	* 코디네이터에 보내지 못하는 데이터가 계속쌓일 수 없기때문에 지우는 작업을 한다.  

## 네트워크층의 기능 
* 멀티 홈이 가능한 메시지 통신 
* 네트워크의 기동 
* 논리 디바이스 타입의 설정 
* 네트워크 주소 관리 
* 네트워크의 참가와 이탈 
* 1홈 범위에서의 인접 노드 발견 
* 라우트 발견과 관리 
* 수신기능 동작 스케줄의 관리 
* 보안기능 (옵션) 

### 네트워크 토폴로지 
* 스타 토폴로지 
  * 증심이 되는 노드로부터 방사 형태로 다른 단말노드를 접속시키는 별 형태의 구성 
  * 단말 노드들끼리는 직접통신이 불가능하고 중심이 되는 노드를 반드시 개입시켜 서로 접속할 수 있음 

* P2P 토폴로지 
  * 네트워크를 구성하는 노드의 지위가 전부 같으며 특별히 중심이 되는 노드를 개입시키지 않고 접속할 수 있는 방식 

* 매쉬 네트워크 
  * 각 노드가 각각 메시지의 중계 기능을 가지고 P2P에 접속하는 메쉬 형의 네트워크 
  * 통신경로를 여려 개 둠으로써 무선통신의 신뢰성을 높일 수 있다. 

* 클러스터 트리 토폴로지 
  * 멀티 홉을 지원하면서도 통신 경로를 확정하여 데이터 전송시간을 일정범위로 보증    
  * 매우 관리하기 쉬운 아키텍쳐이며 대규모 네트워크도 구성이 되지만 통신 경로의 유연성이 결여된다. 


### PAN ID와 주소 
* PAN ID : 특정 PAN을 식별하기 위한 주소 
* IEEE 802.15.4 주소 (이러한 주소들을 사용하여 네트워크와 디바이스를 구분)
  * IEEE 확장 주소 -> 64비트 
  	* 전세계의 IEEE 802.15.4에 준하는 RF칩에 유일한 번호를 할당   
  * 단축주소 : 16비트 
  	* PAN 내부에서만 사용되는 주소 -> 흔하지는 않지만 엄청많이 연결되면 할당받지 못할 수 있다. 
* 네트워크 주소 
  * Zigbee NWK 층에서 단추주소의 정의방법을 정하고 이 주소는 네트워크 주소라고 함
  * 주소 용량 -> 네트워크에 참가하는 자식 노드에 지정 가능한 노드의 최대 수     

### 인접 테이블 
* 네트워크의 참가, 라우팅, 브로드캐스트 등을 수행하는 경우에 1홉 범위에 있는 주변 노드의 정보를 파악하기 위하여 매우 중요한 역할 담당 
* 각 장치들은 주변장치들의 정보를 수집해서 인접테이블로 유지 

### 네트워크 참가 
* 참가하고자 하는 자식 노드가 부모가 되는 노드와의 사이에 부모자식 관계를 확립하고 부모 노드로부터 네트워크 주소를 지정받아서 네트워크 멤버로서 다른노드와 통신을 가능하게 하는 프로세스 

	* 직접참가 
		* 정의한 노드를 등록함 
		* 네트워크에 참가가능한 노드의 주소를 사전에 코디네이터 또는 라우터의 EEPROM에 기록하거나, 네트워크에 참가한 이력이 있는 노드의 주소를 기록하고 다시기동할때는 참가신청하지 않고 저장된 정보에 근거하여 네트워크에 참가하는 기법 
		* 고립스캔으로 바로 넘어간다. 
	* 참가신청 
		* EEPROM에 상대의 정보가 존재하지 않는 경우에 MAC층의 접속 요구로 네트워크에 참가하는 방법 - 알아서 붙는다. 

### 라우팅 
* 적절한 데이터 전송 라우트의 선택 
* 라우트의 발견 
* 라우팅의 유지보수  

* 라우팅 비용 
	* 가능한 적은 홉수와 동시에 링크품질이 높은 경로로 데이터 전송 
	* 저 비용의 라우트를 채용함에 따른 이점 
		* 강한 전계강도의 신호를 채용하기 때문에 통신의 신뢰성을 높인다. 
		* 홉이 적고 재시도가 적기 때문에 데이터 전송에 필요한 시간이 단축되고 네트워크 트래픽과 소비전력이 감소한다. 

	* 링크 비용 
		* 1홉으로 링크된 2개의 노드간의 비용 
		* 멀티 홉의 경우, 데이터 전송에 사용된 경로의 링크 비용 합계를 라우트 비용으로 나타낸다.  
* AODV (Ad hoc On-demand Distance Vector) 
	* 온디멘드형 라우팅 방식 채용 
		* 송신 라우트 탐색이 필요할 때 라우트 발견을 수행하지만, 일단 라우트가 확정되면 데이터 송신이외에 라우팅을 확인하기 위한 불필요한 메시지는 네트워크에 흐르지 않는다. 
		* AODV 송신원은 모든 라우팅 정보를 갖지는 않고 다음 홉의 송신 목적지 정보만을 갖는다. 
			* 라우팅 정보는 라우트를 경유하는 모든 노드에 분산되어 보존된다. 

	* 알고리즘 동작원리 
		* 라우트 발견 요구 노드로부터 경로비용 정보가 포함되어 있는 RREQ의 라우트 요구 메시지가 네트워크에 브로드케스트 된다. 
		* 중간 노드는 수신된 RREQ 메시지의 경로비용에 앞 홉의 링크 비용을 가산하여 새로운 RREQ의 라우트 요구 메시지를 브로드캐스팅한다. (받은 노드가 다시 주변 노드로 뿌린다.) 
		* 가장 낮은 비용의 RREQ메시지가 최종 목적노드에 도착하면 송신라우트를 따라 가면서 RREQ 응답 메시지를 유니캐스트로 답신하고 라우트 발견 요구를 송신한 노드까지 거슬러 올라가 발견된 라우트를 확립한다. 

	* RREQ (라우트 발견 응답) 
		* 발견된 라우팅을 확정하기 위한 RREP 응답 메시지가 필요하다. 
		* RREP메시지 
			* 발견 요구 시퀀스 번호 
			* 라우팅을 요구하는 노드의 주소 
			* 라우팅 발견을 응답하는 노드의 주소 
			* 잔류 비용      